# Define the server block for handling incoming requests
server {
    # Nginx will listen for requests on port 80, which is exposed from the container
    listen 80;

    # The main location block for the root URL
    # This serves your Next.js frontend
    location / {
        proxy_pass http://rag-admin-frontend:3000;

        # These headers are crucial for passing client information to the backend
        # like the original IP address and host.
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # This single location block handles all backend traffic, including docs, at /api/
    # The trailing slash on `proxy_pass` is critical for FastAPI to resolve paths correctly
    location /api/ {
        # Proxy the request to the backend service.
        proxy_pass http://fastapi-backend:8000/;

        # Set standard proxy headers for the backend
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}